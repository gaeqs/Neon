#version 460
#extension GL_EXT_mesh_shader: enable

layout (local_size_x = 1, local_size_y = 1, local_size_z = 1) in;
layout (triangles) out;
layout (max_vertices = 4, max_primitives = 2) out;

layout (set = 0, binding = 0) uniform Matrices
{
    mat4 view;
    mat4 viewProjection;
    mat4 inverseProjection;
    float near;
    float far;
};

layout(std430, binding = 2, set = 0) buffer Data {
    vec3 vertices[];
};

void main()
{

    SetMeshOutputsEXT(4, 2);

    gl_MeshVerticesEXT[0].gl_Position = viewProjection * vec4(vertices[0], 1.0); // Upper Left
    gl_MeshVerticesEXT[1].gl_Position = viewProjection * vec4(0.6, -0.6, 0.0, 1.0); // Upper Right
    gl_MeshVerticesEXT[2].gl_Position = viewProjection * vec4(-0.6, 0.6, 0.0, 1.0); // Bottom Left
    gl_MeshVerticesEXT[3].gl_Position = viewProjection * vec4(0.6, 0.6, 0.0, 1.0); // Bottom Right
    gl_PrimitiveTriangleIndicesEXT[0] = uvec3(0, 1, 2);
    gl_PrimitiveTriangleIndicesEXT[1] = uvec3(1, 3, 2);
}
    